resources:
  repositories:
  - repository: ci-wex-build
    type: github
    endpoint: ci-wex-build
    name: wincomplm/ci-wex-build

pool:
  vmImage: windows-latest

variables:
- group: EDK Build Settings

jobs:
- job: BuildExtension
  displayName: Build Extension

  steps:
  - checkout: self
  - checkout: ci-wex-build

  - task: PowerShell@2
    displayName: 'Getting Wex file'
    inputs:
      targetType: inline
      script: |
        $file = "pepito"
        Write-Host "##vso[task.setvariable variable=buildId;]$(file)"
        Copy-Item $file -Destination '$(build.artifactstagingdirectory)/'
        [string] $wexId= $Env:buildId
        Write-Host "The buildId environment variable value is '$wexId'." 
        write-host "env $env:buildId"

  - task: PowerShell@2
    displayName: 'Deploy Single WEX on Auto Test Server'
    inputs:
      targetType: filePath
      filePath: '$(Build.SourcesDirectory)/ci-wex-build/build/deployToWindchill.ps1'
      arguments: '-user $(wcadmin) -pass $(wcpassword) -wcserver "https://wex-auto-test.wincom-cloud.net/Windchill" -file $(build.artifactstagingdirectory)/$(buildId)'